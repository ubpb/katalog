- search_request ||= nil
- search_result  ||= nil

tr.hit
  /td.hidden-xs(style="vertical-align: middle; text-align: center;")
    = ractive_component "skala.components.Image",
      placeholder: "<i class='fa fa-book' style='font-size: 44px; color: lightgrey;' />",
      src: hit.image.try(:find) { |_image| _image["type"] == "tiny" }.try(:[], "url")

  td
    .title
      = link_to record_path hit.id,\
        scope: scope,\
        search_request: search_request do
        = [*hit.fields["title"]].join("; ").presence || "-"

    - if hit.fields["is_part_of"].present?
      .is-part-of
        ul
          - [*[hit.fields["is_part_of"]]].flatten.each do |_superorder|
            li
              - if (ht_number = _superorder["ht_number"]).present?
                = link_to _superorder["label"], searches_path(\
                  search_request: Skala::SearchRequest.new(\
                    queries: {\
                      type: "query_string",\
                      query: ht_number,\
                      default_field: "ht_number"\
                    }\
                  ),\
                  scope: scope.id\
                )
                /= link_to _superorder["label"], new_searches_path({query: ht_number, field: "ht_number"}, scope: scope.id, sort: { field: "volume_count2" })

              - else
                = _superorder["label"]

              /- if _superorder["volume"].present?
                = "; Bd. #{_superorder["volume"].first}"

              /- if (_identifier = _superorder["identifier"].try(:first)).present?
                = link_to searches_path(\
                    search_request: hit.scope.search_request_factory(is_part_of: _identifier),\
                    scope: hit.scope\
                  ) do
                  =< "(#{t('.all_parts')})"

    /.aggregated-details
      = hit.aggregate(:creator, :edition, :created)

    /- if hit.accrual_policy.present?
      .accrual_policy: ul
        - hit.accrual_policy.each do |_accrual_policy|
          li = "#{t('.accrual_policy')}: #{_accrual_policy}"

    /= ractive_component "skala.components.AvailabilityIndicator",
      api_v1_record_items_path: api_v1_record_items_path(":record_id"),
      record: { id: hit.id },
      scope: { id: hit.scope.id },
      style: "margin-right: 4px"

    /- if hit.signature.present?
      span.signature = hit.signature.first

    /= ractive_component "skala.components.Note",
      note: @notes.try(:find) { |_note| \
        _note.record_id == hit.id\
      },\
      record: { id: hit.id },
      translations: I18n.config.backend.send(:translations)[current_locale][:components][:Note]

    /= ractive_component "skala.components.WatchLists",
      record: { id: hit.id },
      user_watch_list_path: user_watch_list_path(":id"),
      watch_lists: @watch_lists.try(:as_json, \
        only: [:id, :name], \
        include: { \
          entries: { \
            only: [:id, :record_id, :watch_list_id] \
          } \
        } \
      )

  /td
    = ractive_component "skala.components.RecordActions",
      api_v1_record_path: api_v1_record_path(":id"),
      api_v1_user_notes_path: api_v1_user_notes_path(":user_id"),
      api_v1_user_note_path: api_v1_user_note_path(":user_id", ":id"),
      api_v1_user_watch_lists_path: api_v1_user_watch_lists_path(":user_id"),
      api_v1_user_watch_list_entries_path: api_v1_user_watch_list_entries_path(":user_id", ":watch_list_id"),
      api_v1_user_watch_list_entry_path: api_v1_user_watch_list_entry_path(":user_id", ":watch_list_id", ":id"),
      class: "pull-right",
      note: @notes.try(:find) { |_note| \
        _note.record_id == hit.id\
      },\
      record: { id: hit.id },
      scope: { id: hit.scope.id },
      translations: I18n.config.backend.send(:translations)[current_locale][:components][:RecordActions],
      user: current_user.try(:slice, :id),
      watch_lists: @watch_lists.try(:as_json, \
        only: [:id, :name], \
        include: { \
          entries: { \
            only: [:id, :record_id] \
          } \
        } \
      )
